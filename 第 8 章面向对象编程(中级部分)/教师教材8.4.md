# 8.7 封装快速入门案例

## 8.7.1 基础案例：Person 类的封装实现

### 需求场景

在实际开发中，我们经常需要对类的属性进行访问控制。例如，一个人的年龄不能是负数或超过 120 岁，姓名长度需要在合理范围，工资等隐私信息不应被随意查看。下面通过`Person`类的实现，演示如何用封装解决这些问题。

### 完整代码实现

```java
package com.hspedu.encap;

public class Encapsulation01 {
    public static void main(String[] args) {
        // 测试无参构造器创建对象
        Person person = new Person();
        person.setName("韩顺平");  // 设置合法姓名
        person.setAge(30);         // 设置合法年龄
        person.setSalary(30000);   // 设置工资
        System.out.println(person.info());  // 输出完整信息
        System.out.println("工资：" + person.getSalary());  // 获取工资

        // 测试全参构造器创建对象
        Person smith = new Person("smith", 80, 50000);
        System.out.println("====smith的信息====");
        System.out.println(smith.info());
    }
}

class Person {
    private String name;    // 姓名（私有化）
    private int age;        // 年龄（私有化）
    private double salary;  // 工资（私有化，隐私信息）

    // 无参构造器
    public Person() {}

    // 全参构造器（复用set方法的校验逻辑）
    public Person(String name, int age, double salary) {
        setName(name);   // 调用setName校验姓名
        setAge(age);     // 调用setAge校验年龄
        setSalary(salary); // 调用setSalary设置工资
    }

    // name的set方法（含长度校验）
    public void setName(String name) {
        if (name.length() >= 2 && name.length() <= 6) {
            this.name = name;
        } else {
            System.out.println("姓名长度需在2-6个字符之间，设置默认值“无名人”");
            this.name = "无名人";
        }
    }

    // name的get方法
    public String getName() {
        return name;
    }

    // age的set方法（含范围校验）
    public void setAge(int age) {
        if (age >= 1 && age <= 120) {
            this.age = age;
        } else {
            System.out.println("年龄需在1-120岁之间，设置默认值18");
            this.age = 18;
        }
    }

    // age的get方法
    public int getAge() {
        return age;
    }

    // salary的set方法
    public void setSalary(double salary) {
        this.salary = salary;
    }

    // salary的get方法（控制隐私访问）
    public double getSalary() {
        // 实际开发中可添加权限校验，如仅管理员可查看
        return salary;
    }

    // 返回对象完整信息
    public String info() {
        return "姓名：" + name + "，年龄：" + age + "，工资：" + salary;
    }
}
```

### 代码解析

1. **属性私有化**
   将`name`、`age`、`salary`用`private`修饰，确保外部无法直接修改，只能通过类提供的方法操作，从根本上保证数据安全。
2. **set 方法的校验逻辑**
   - `setName`：通过判断字符串长度，确保姓名在 2-6 个字符之间，不符合则设置默认值 “无名人”；
   - `setAge`：限制年龄范围为 1-120 岁，超出范围则自动设置为 18 岁，避免不合理数据；
   - 这些校验逻辑是封装 “保护数据安全” 的核心体现。
3. **get 方法的访问控制**
   - `getSalary`作为工资的唯一访问入口，未来可轻松添加权限控制（如仅允许管理员查看），体现封装的灵活性。
4. **构造器与 set 方法的结合**
   全参构造器没有直接为属性赋值，而是调用`setName`、`setAge`等方法，这样既复用了校验逻辑，又保证了无论通过构造器初始化还是后续修改，都遵循相同的规则。

## 8.7.2 构造器与 setXxx 方法结合的优势

在上述案例中，全参构造器通过调用`setXxx`方法实现属性赋值，这种设计有三个关键优势：

1. **代码复用**
   校验逻辑只需在`setXxx`方法中编写一次，构造器和外部修改属性时均可复用，避免重复代码。
2. **校验一致性**
   无论通过构造器创建对象，还是通过`setXxx`修改属性，都使用相同的校验规则，确保数据在任何场景下都合法。
3. **易于维护**
   若需修改校验规则（如将姓名长度改为 2-8 个字符），只需修改`setName`方法，无需改动构造器，降低维护成本。

## 8.7.3 课堂练习：Account 类的封装设计

### 需求说明

设计一个银行账户类`Account`，要求：

- 姓名（`name`）：长度为 2-4 个字符，不符合则默认 “无名”；
- 余额（`balance`）：必须大于 20 元（最低开户金额），不符合则默认 0；
- 密码（`pwd`）：必须是 6 位，不符合则默认 “000000”；
- 提供无参和全参构造器，全参构造器需复用`setXxx`方法的校验逻辑；
- 提供`showInfo`方法展示账户信息。

### 参考实现

#### 1. Account 类

```java
package com.hspedu.encap;

public class Account {
    private String name;    // 姓名
    private double balance; // 余额
    private String pwd;     // 密码

    // 无参构造器
    public Account() {}

    // 全参构造器（复用set方法校验）
    public Account(String name, double balance, String pwd) {
        setName(name);
        setBalance(balance);
        setPwd(pwd);
    }

    // name的set方法（长度校验）
    public void setName(String name) {
        if (name.length() >= 2 && name.length() <= 4) {
            this.name = name;
        } else {
            System.out.println("姓名长度需为2-4个字符，默认“无名”");
            this.name = "无名";
        }
    }

    public String getName() {
        return name;
    }

    // balance的set方法（最低金额校验）
    public void setBalance(double balance) {
        if (balance > 20) {
            this.balance = balance;
        } else {
            System.out.println("余额必须>20元，默认0");
            this.balance = 0;
        }
    }

    public double getBalance() {
        return balance;
    }

    // pwd的set方法（长度校验）
    public void setPwd(String pwd) {
        if (pwd.length() == 6) {
            this.pwd = pwd;
        } else {
            System.out.println("密码必须6位，默认“000000”");
            this.pwd = "000000";
        }
    }

    public String getPwd() {
        return pwd;
    }

    // 展示账户信息
    public void showInfo() {
        System.out.println("账户信息：姓名=" + name + "，余额=" + balance + "，密码=" + pwd);
    }
}
```

#### 2. 测试类 TestAccount

```java
package com.hspedu.encap;

public class TestAccount {
    public static void main(String[] args) {
        // 测试合法数据
        Account account1 = new Account();
        account1.setName("jack");   // 4个字符（合法）
        account1.setBalance(60);    // >20（合法）
        account1.setPwd("123456");  // 6位（合法）
        account1.showInfo();        // 输出：账户信息：姓名=jack，余额=60.0，密码=123456

        // 测试非法数据
        Account account2 = new Account("a", 10, "123");
        // 输出提示：
        // 姓名长度需为2-4个字符，默认“无名”
        // 余额必须>20元，默认0
        // 密码必须6位，默认“000000”
        account2.showInfo();        // 输出：账户信息：姓名=无名，余额=0.0，密码=000000
    }
}
```

### 练习解析

- 该案例完整实现了封装的三步流程：私有化属性→`set`方法校验→`get`方法访问；
- 全参构造器复用`setXxx`方法，确保初始化时的数据合法性；
- 若后续需要增强功能（如密码加密），只需修改`setPwd`方法，其他代码无需变动，体现封装的可维护性。

## 总结

封装通过 “私有化属性 +`set`方法校验 +`get`方法访问” 的模式，实现了数据的安全管理和逻辑复用。构造器与`setXxx`方法的结合，进一步保证了数据校验的一致性和代码的可维护性。掌握这些技巧，能为后续学习继承和多态打下坚实基础。